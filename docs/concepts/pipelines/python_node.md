# Python Node
The Python node allows the bot builder to execute custom Python code to perform logic, data processing, or other tasks.

The code **must** define a `main` function which takes the node input as a string and returns a string to pass to the next node.
The `main` function must also accept arbitrary keyword arguments to support future features. Here is an example of what the code might look like:

```python
def main(input, **kwargs) -> str:
    # Put your code here
    return input
```

The `input` parameter is a string that contains the input to the node. The return value of the function is a string that will be passed to the next node in the pipeline.

## Additional Keyword Arguments

The following additional arguments are provided:

* `node_inputs: list[str]` - A list of all the inputs to the node at the time of execution. This will be the same as `[input]` except when the node is part of a workflow with [parallel branches](./parallel.md).

!!! warning

    All the code must be encapsulated in a `main` function. You can write other functions but they must be within the scope of the `main` function. For example:

    ``` py
    def main(input, **kwargs):
        def important(arg):
            return arg + "!"

        return important(input)
    ```

## Utility Functions

The Python node provides a set of utility functions that can be used to interact with the user's data and the pipeline state.

### ::: python_node.get_participant_data
### ::: python_node.set_participant_data
### ::: python_node.set_participant_data_key
### ::: python_node.append_to_participant_data_key
### ::: python_node.increment_participant_data_key
### ::: python_node.get_participant_schedules
### ::: python_node.get_temp_state_key
### ::: python_node.set_temp_state_key
### ::: python_node.get_session_state_key
### ::: python_node.set_session_state_key
### ::: python_node.get_selected_route
### ::: python_node.get_node_path
### ::: python_node.get_all_routes
### ::: python_node.add_message_tag
### ::: python_node.add_session_tag
### ::: python_node.get_node_output
### ::: python_node.require_node_outputs
### ::: python_node.wait_for_next_input
### ::: python_node.abort_with_message

## HTTP Client

The Python node provides an `http` global that enables secure HTTP requests to external APIs. See the [HTTP Client](http_client.md) page for full documentation.

## Temporary State
The Python node can also access and modify the temporary state of the pipeline. The temporary state is a dictionary that is unique to each run of the pipeline (each new message from the user) and is not stored between sessions.

The temporary state can be accessed and modified using the [get_temp_state_key](#python_node.get_temp_state_key) and [set_temp_state_key](#python_node.set_temp_state_key) utility functions.

Temporary state contains the following keys by default. These keys can not be modified or deleted:

| Key           | Description                                                                  |
|---------------|------------------------------------------------------------------------------|
| `user_input`  | The message sent by the user                                                 |
| `outputs`     | The outputs generated by the previous node                                   |
| `attachments` | A list of attachments passed in by the user. See [Attachments](#attachments) |

In addition to these keys, the temporary state can also contain custom key-value pairs that can be set and accessed by the Python node and by the [Static Router](nodes.md#static-router) node.

Here is an example of a temporary state dictionary:

```python
{
    "user_input": "Please help me with my problem",
    "outputs": {
        "Assistant": "I'm here to help! What can I do for you?"
    },
    "attachments": [
        Attachment(...),
    ],
    "my_custom_key": "my_custom_value",
}
```

## Session State
The Python node can also access and modify the state of the participant's session. This state is a dictionary that is scoped to each session that the user might have with the bot.

The session state can be accessed and modified using the [get_session_state_key](#python_node.get_session_state_key) and [set_session_state_key](#python_node.set_session_state_key) utility functions.

## Attachments

Part of the temporary state is a list of attachments. Attachments are files that the user has uploaded to the bot. Each attachment has the following fields:

| Field                 | Description                                                           |
|-----------------------|-----------------------------------------------------------------------|
| `name`                | The name of the file                                                  |
| `size`                | The size of the file in bytes                                         |
| `content_type`        | The MIME type of the file                                             |
| `upload_to_assistant` | Whether the file should be uploaded to the assistant as an attachment |
| `read_bytes()`        | Reads the attachment content as bytes.                                |
| `read_text()`         | Reads the attachment content as text.                                 |

Here is an example of an attachment object:

```python
attachment = Attachment(
    name="proposal.pdf",
    size=1234,
    content_type="application/pdf",
    upload_to_assistant=False,
)
content = attachment.read_text()
```

### Supported File Types
The Python node currently only supports reading the contents of the following file types:

- Text-based formats (TXT, CSV, HTML, JSON, XML, etc.)
- PDF
- DOCX
- XLSX
- XLS
- Outlook
- PPTX

Other file types can still be uploaded to assistants but the Python Node is not able to read the file contents using the `read_text()` method on the attachment.
